# 스프링 앱에서 데이터 소스 사용

## 12.1 데이터 소스

데이터 소스(Data Source)는 데이터를 제공하는 출처 또는 저장소를 의미합니다. 데이터 소스는 애플리케이션이 데이터를 읽거나 쓸 수 있는 데이터베이스, 파일 시스템, API, 또는 기타 데이터 저장 장치를 포함합니다. 데이터 소스는 애플리케이션이 필요한 데이터를 얻고 이를 사용하여 다양한 작업을 수행할 수 있게 합니다.

스프링 프레임워크에서는 데이터 소스를 정의하고 관리하는 다양한 방법을 제공합니다. 데이터 소스는 주로 데이터베이스 연결을 설정하고 관리하는 데 사용되며, 이를 통해 데이터베이스에 질의(query)를 수행하거나 데이터를 업데이트할 수 있습니다.

다음은 데이터 소스의 주요 특징과 이를 설정하는 방법에 대한 간단한 설명입니다.

- 주요 특징
    1. 연결 관리 : 
        - 데이터 소스는 데이터베이스 연결을 생성하고 관리합니다. 이는 연결 풀(Connection Pool)을 사용하여 효율적으로 관리될 수 있습니다.
    2. 트랜잭션 관리:
        - 데이터 소스는 트랜잭션을 관리하여 데이터베이스 작업의 일관성을 유지합니다.
    3. 보안:
        - 데이터 소스는 데이터베이스 자격 증명(예: 사용자 이름 및 비밀번호)을 포함하여 보안 설정을 관리합니다.
       

### 데이터 소스 설정 방법
스프링에서 데이터 소스를 설정하는 방법은 여러 가지가 있습니다. 그 중 두 가지 일반적인 방법을 소개합니다.

1. application.properties 또는 application.yml 파일을 사용하여 설정하기
   스프링 부트에서는 application.properties 또는 application.yml 파일을 통해 간단하게 데이터 소스를 설정할 수 있습니다.
---
        # application.properties
        spring.datasource.url=jdbc:mysql://localhost:3306/mydb
        spring.datasource.username=myuser
        spring.datasource.password=mypassword
        spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
---
        # application.yml
        spring:
        datasource:
        url: jdbc:mysql://localhost:3306/mydb
        username: myuser
        password: mypassword
        driver-class-name: com.mysql.cj.jdbc.Driver


2. Java Configuration 클래스를 사용하여 설정하기
   Java Configuration 클래스를 사용하여 데이터 소스를 설정할 수도 있습니다.
---
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.jdbc.datasource.DriverManagerDataSource;
    import javax.sql.DataSource;
    
    @Configuration
    public class DataSourceConfig {
    
        @Bean
        public DataSource dataSource() {
            DriverManagerDataSource dataSource = new DriverManagerDataSource();
            dataSource.setDriverClassName("com.mysql.cj.jdbc.Driver");
            dataSource.setUrl("jdbc:mysql://localhost:3306/mydb");
            dataSource.setUsername("myuser");
            dataSource.setPassword("mypassword");
            return dataSource;
        }
    }

이와 같이 데이터 소스를 설정하면 스프링 애플리케이션이 데이터베이스와 연결하고 데이터를 읽고 쓰는 작업을 수행할 수 있습니다.

데이터 소스의 설정과 관리는 애플리케이션의 데이터베이스 작업의 성능과 안정성을 높이는 중요한 요소입니다.

## 12.2 JdbcTemplate  으로 영속성 데이터 작업

### JdbcTemplate 란

JdbcTemplate는 스프링 프레임워크에서 제공하는 클래스 중 하나로, JDBC (Java Database Connectivity) 코드의 단순화를 위해 사용됩니다. JdbcTemplate는 데이터베이스와의 상호작용을 쉽게 만들고, 반복적인 코드 작성을 피할 수 있게 도와줍니다. 이를 통해 개발자는 SQL 쿼리 실행, 결과 처리 및 예외 처리를 간편하게 수행할 수 있습니다.

 - 주요 기능
    1. SQL 쿼리 실행: SELECT, INSERT, UPDATE, DELETE와 같은 SQL 쿼리를 실행할 수 있습니다.
    2. 결과 처리: RowMapper, ResultSetExtractor 등을 사용하여 쿼리 결과를 객체로 매핑할 수 있습니다.
    3. 예외 처리: 스프링의 데이터 액세스 예외 계층을 통해 표준화된 예외 처리를 제공합니다.
    4. 트랜잭션 관리: 트랜잭션 관리를 단순화하고, 명시적 트랜잭션 관리를 지원합니다.

---

### 영속성 계층을 구현할 때의 장점

영속성 계층(Persistence Layer)을 구현하는 것은 애플리케이션 설계에서 중요한 역할을 하며, 여러 가지 장점이 있습니다. 영속성 계층은 데이터베이스와 상호작용하는 모든 로직을 처리하고, 비즈니스 로직과 데이터 접근 로직을 분리함으로써 애플리케이션의 구조를 체계화하는 데 도움을 줍니다.

 - 영속성 계층을 구현할 때의 주요 장점
    1. 모듈화 및 유지보수 용이성 : 데이터 접근 로직을 별도의 계층으로 분리함으로써 코드의 모듈화를 촉진합니다. 이는 유지보수와 관리가 용이해지고, 특정 기능이나 모듈을 수정할 때 다른 부분에 영향을 주지 않도록 합니다.
    2. 재사용성 : 데이터 접근 로직을 여러 비즈니스 로직에서 재사용할 수 있습니다. 같은 데이터 접근 코드가 중복되지 않고 한 곳에 모여 있기 때문에 재사용이 쉬워집니다.
    3. 테스트 용이성 : 비즈니스 로직과 데이터 접근 로직이 분리되어 있으면, 각각의 로직을 독립적으로 테스트할 수 있습니다. 이는 유닛 테스트 및 통합 테스트를 작성하고 실행하는 데 유리합니다.
    4. 유연성 : 데이터 소스나 데이터베이스를 변경할 때, 영속성 계층만 수정하면 됩니다. 예를 들어, 데이터베이스를 MySQL에서 PostgreSQL로 변경하거나, 파일 시스템에서 NoSQL 데이터베이스로 변경하는 경우 영속성 계층에서만 수정이 필요합니다.
    5. 비즈니스 로직과 데이터 접근 로직의 분리 : 비즈니스 로직과 데이터 접근 로직을 분리하여 서로 독립적으로 관리할 수 있습니다. 이는 코드의 가독성을 높이고, 비즈니스 로직에 집중할 수 있게 합니다.
    6. 트랜잭션 관리 : 영속성 계층에서 일관된 트랜잭션 관리를 구현할 수 있습니다. 여러 데이터베이스 작업을 하나의 트랜잭션으로 묶어 처리함으로써 데이터의 일관성과 무결성을 보장합니다.
    7. 성능 최적화 : 데이터 접근 로직을 집중적으로 최적화할 수 있습니다. 예를 들어, 캐싱, 배치 처리, 쿼리 최적화 등의 성능 향상 기법을 영속성 계층에서 적용할 수 있습니다.


## 12.3 데이터 소스 구성을 사용자 정의

### 12.3.1 애플리케이션 프로퍼티 파일에서 데이터 소스 정의
 - 스프링 애플리케이션에서 application.properties 또는 application.yml 파일을 사용하여 데이터 소스를 정의할 수 있습니다. 이를 통해 데이터베이스 연결 정보를 외부 설정 파일에 넣어 관리할 수 있으며, 설정 파일을 쉽게 변경할 수 있습니다.

### 12.3.2 사용자 정의 DataSource 빈 사용
 - 스프링 애플리케이션에서 사용자 정의 DataSource 빈을 사용하는 방법을 설명하겠습니다. DataSource는 데이터베이스 연결을 관리하는 중요한 구성 요소이며, 스프링 부트에서는 기본적으로 자동 구성된 DataSource를 제공합니다. 하지만 사용자 정의 구성을 통해 더욱 세부적인 설정이 필요할 때가 있습니다.


## 12.4 요약
 - 자바 애플리케이션은 JDK 라는 앱이 관계형 데이터베이스 연결에 필요한 객체의 추상화를 구현하는 런타임 의존성을 추가해야 한다. 이런 의존성을 JDBC 드라이버라 한다.
 - 데이터 소스는 데이터베이스 서버에 대한 커넥션을 관리하는 객체다. 데이터 소스가 없다면 앱이 컨넥션을 너무 자주 요청해서 성능에 영향을 미친다.
 - 스프링 부트는 HikariCP 라는 데이터 소스 구현을 기본적으로 구성한다. 이 HikariCP는 커넥션 풀로 앱이 데이터베이스에 대한 커넥션을 사용하는 방식을 최적화한다. 앱에 다른 데이터 소스 구현제가 더 적절하다면 다른 것을 사용할 수 있다.
 - JdbcTemplate 은 JDBC 를 사용하여 관계형 데이터베이스에 액세스하려고 작성하는 코드를 간소화하는 스프링 도구다. JdbcTemplate 객체는 데이터베이스 서버에 접속하려고 데이터소스에 의존한다.
 - 테이블의 데이터를 변경하는 쿼리를 전송하려면 JdbcTemplate 객체의 update() 메서드를 사용한다.
 - 데이터를 검색할 수 있게 SELECT 쿼리를 보내려면 JdbcTemplate 의 query() 메서드 중 하니를 사용한다. 이런 작업은 대부분 영속성 데이터를 변경하거나 검색할 때 사용해야 한다.
 - 스프링 부트 애플리케이션에서 사용되는 데이터 소스를 사용자 정의하려면 java.sql.DataSource 타입의 빈을 맞춤 구성한다. 스프링의 컨텍스트에서 이 타입의 빈을 선언하면 스프링 부트는 기본 빈을 구성하지 않고 이 빈을 사용한다. 사용자 정의 JdbcTemplate 객체가 필요할 때도 동일한 방식을 사용한다. 일반적으로 스프링 부트에서 제공하는 기본갓을 사용하지만, 특정 상황에서는 다양하게 최적화를 하려고 사용자 정의 구성 또는 구현이 필요할 때도 있다.
 - 앱이 여러 데이터베이스에 연결하려면 고유한 JdbcTemplate 객체가 연결된 여러 데이터 소스 객체를 만들 수 있다. 이런 시나리오에서는 애플리케이션 컨텍스트에서 동일한 타입의 객체를 구별하는 데 @Qualifier 애너테이션을 사용해야 한다.


