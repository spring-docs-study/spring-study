# REST 엔드포인트 사용

> 그림 11-1 다른 서비스에서 노출된 REST 엔드포인트를 호출하는 방법
> ![그림 11-1](\김민섭\springsutdy\src\main\resources\md파일\스터디 6회\그림 11-1.jpg)

 - 스프링 앱에서 REST 엔드포인트를 호출하는 다음 세 가지 방법 
   1. OpenFeign : 스프링 클라우드 프로젝트에서 제공하는 도구, 새 앱에서 REST 엔드포인트를 사용할 때 이 기능을 추천한다.
   2. RestTemplate : 스프링 3 부터 개발자들이 REST 엔드포인트를 호출하는 데 사용하여 널리 알려진 도구로, 오늘날 스프링 앱에서 자주 쓴다. 하지만 OpenFeign이 RestTemplate보다 더 좋은 대안이므로 새로운 앱에서 작업한다면 RestTemplate 대신 OpenFeign을 사용할 가능성이 높다.
   3. WebClient : RestTemplate의 대안으로 제시된 스프링의 기능이다. 이 기능은 리액티브 프로그래밍이라는 다른 프로그래밍 방식을 사용하며, 이 장의 마지막 부분에서 설명한다.


---


스프링 애플리케이션에서 REST 엔드포인트를 호출하는 세 가지 방법을 소개합니다. 각각의 방법은 특정 상황에 따라 더 적합할 수 있습니다.

RestTemplate 사용하기:
RestTemplate은 스프링에서 제공하는 동기식 HTTP 클라이언트입니다. 간단한 REST API 호출을 수행할 때 많이 사용됩니다.

    import org.springframework.web.client.RestTemplate;
    import org.springframework.http.ResponseEntity;
    
    public class RestClient {
    private static final String BASE_URL = "https://api.example.com";
    
        public static void main(String[] args) {
            RestTemplate restTemplate = new RestTemplate();
            String resourceUrl = BASE_URL + "/endpoint";
            
            // GET 요청
            ResponseEntity<String> response = restTemplate.getForEntity(resourceUrl, String.class);
            System.out.println(response.getBody());
    
            // POST 요청
            String requestPayload = "{\"key\": \"value\"}";
            ResponseEntity<String> postResponse = restTemplate.postForEntity(resourceUrl, requestPayload, String.class);
            System.out.println(postResponse.getBody());
        }
    }


WebClient 사용하기:
WebClient는 스프링 5에서 도입된 비동기식 HTTP 클라이언트입니다. 비동기식 호출을 원하거나, 더 나은 성능을 위해 리액티브 프로그래밍을 사용할 때 적합합니다.

    import org.springframework.web.reactive.function.client.WebClient;
    import reactor.core.publisher.Mono;
    
    public class RestClient {
    private static final String BASE_URL = "https://api.example.com";
    private WebClient webClient = WebClient.builder().baseUrl(BASE_URL).build();
    
        public static void main(String[] args) {
            RestClient client = new RestClient();
            client.getRequest();
            client.postRequest();
        }
    
        public void getRequest() {
            Mono<String> response = webClient.get()
                .uri("/endpoint")
                .retrieve()
                .bodyToMono(String.class);
    
            response.subscribe(System.out::println);
        }
    
        public void postRequest() {
            String requestPayload = "{\"key\": \"value\"}";
            Mono<String> response = webClient.post()
                .uri("/endpoint")
                .bodyValue(requestPayload)
                .retrieve()
                .bodyToMono(String.class);
    
            response.subscribe(System.out::println);
        }
    }


Feign 클라이언트 사용하기:
Feign은 선언적 HTTP 클라이언트로, 인터페이스를 통해 REST API를 호출할 수 있습니다. 코드가 간결해지고 유지보수가 용이해집니다.

    import org.springframework.cloud.openfeign.FeignClient;
    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.PostMapping;
    import org.springframework.web.bind.annotation.RequestBody;
    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RequestMethod;
    import org.springframework.stereotype.Service;
    import org.springframework.beans.factory.annotation.Autowired;
    
    @FeignClient(name = "apiClient", url = "https://api.example.com")
    public interface ApiClient {
    @GetMapping("/endpoint")
    String getEndpoint();
    
        @PostMapping("/endpoint")
        String postEndpoint(@RequestBody String payload);
    }
    
    @Service
    public class RestClient {
    @Autowired
    private ApiClient apiClient;
    
        public void callApis() {
            // GET 요청
            String getResponse = apiClient.getEndpoint();
            System.out.println(getResponse);
    
            // POST 요청
            String postResponse = apiClient.postEndpoint("{\"key\": \"value\"}");
            System.out.println(postResponse);
        }
    }


이 세 가지 방법 모두 RESTful 서비스를 호출하는 데 유용하며, 각 방법의 장점과 단점을 고려하여 선택할 수 있습니다.

---



# 11.4
## 요약
   - 실제 백엔드 솔루션에서는 다른 백엔드 앱이 노출한 엔드포인트를 한 백엔드 앱이 호출해야 할 때가 많다.
   - 스프링은 REST 서비스의 클라이언트 측을 구현하는 데 필요한 여러 솔루션을 제공한다. 가장 유력한 세 가지 솔루션은 다음과 같다.
     - OpenFeign : 스프링 클라우드 프로젝트에서 제공된 솔루션으로 REST 엔드포인트를 호출하기 위해 작성해야 하는 코드를 간소화하고, 오늘날 서비스 구현 방식과 관련된 다양한 기능을 추가한다.
     - RestTemplate : 스프링 앱에서 REST 엔드포인트를 호출하는 데 사용되는 간단한 도구이다.
     - WebClient : 스프링 앱에서 REST 엔드포인트를 호출하는 리액티브 솔루션이다.
   - 새롭게 구현할 곳에서 RestTemplate 을 사용해서는 안 된다. OpenFeign 과 WebClient 중에서 선택해서 REST 엔드포인트를 호출할 수 있다.
   - 표준 방식을 따르는 앱이 선택할 수 있는 가장 좋은 방법은 OpenFeign을 사용하는 것이다.
   - WebClient 는 리액티브 방식으로 설계된 앱을 위한 훌륭한 도구다. 하지만 사용하기 전에 리액티브 방식과 스프링에서 리액티브 앱의 구현 방법을 깊이 이해해야 한다.

