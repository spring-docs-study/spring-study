# 7장 - 스프링 부트와 스프링 MVC 이해
스프링을 사용하면 웹 앱 개발이 간단해진다 <br>

## 웹 앱이란?
웹 브라우저로 접속하는 모든 앱은 웹 앱이다 <br>
### 웹 앱에 대한 일반적인 개요
웹 앱은 두 부분으로 구성된다.
- 클라이언트 측: 사용자가 직접 상호작용 하는 부분이다. 웹 앱의 클라이언트 측을 대표하는 웹 브라우저는 웹 서버에 요청을 보내고, 서버에서 응답을 수신하며, 사용자가 앱과 상호작용할 수 있는 방법을 제공한다.
- 서버 측: 클라이언트에서 요청을 수신하고 응답에 데이터를 회신한다. 

백엔드는 동시에 여러 클라이언트에 서비스를 제공할 수 있어야 한다 <br>

#### 스프링으로 웹 앱을 구현하는 다양한 방식
1) 클라이언트 요청에 응답하여 백엔드가 완성된 뷰를 제공하는 앱 -> 백엔드에서 웹 도 구성  ex) JSP
2) 프론트엔드 백엔드 분리 방식의 앱 -> 프론트,백 아예 분리 ex) React ~ SpringBoot
- 서버에서 JSON 형태로 데이터를 내려주고, 프론트에서 그걸 해석해서 ui 로 만든다.

프로덕션 앱에서 이 두가지 방식을 모두 발견할 수 있다 <br>
때때로 개발자들은 프론트-백엔드 방식을 최신 방식이라고도 한다 <br>

프론트,백을 분리하면 대규모 어플리케이션 개발을 더 쉽게 관리할 수 있다 <br>
프론트,백 배포를 독립적으로 관리도 할 수 있다 <br>

프론트-백엔드 분리를 하지않는 것은 소규모 앱에 적합하다 <br>

### 웹 앱 개발에서 서블릿 컨테이너 사용
웹 브라우저는 HTTP 프로토콜을 이용하여 네트워크를 통해 서버와 통신한다 <br>
이 프로토콜은 클라이언트와 서버가 네트워크를 통해 데이터를 교환하는 방법을 정확하게 설명한다 <br>
Http 는 1:1 요청 응답 방식을 가진다, 1가지 요청을 보냈으면 1가지 응답이 와야한다 <br>

실제로 Http 프로토콜을 이해하고 http 요청과 응답을 자바 앱으로 변환하는 것이 필요하다 <br>
이것이 바로 웹 서버라고 하는 서블릿 컨테이너 이며, 자바 앱 http 메시지를 변환하는 역할을 한다 <br>

서블릿 컨테이너를 사용하면 자바 앱의 통신 계층을 구현할 필요가 없다 <br>
가장 널리 사용되는게 톰캣이다, 스프링부트는 임베디드 톰캣을 내장하고있다 <br>

Servlet 이란 서블릿 컨테이너와 직접 상호작용하는 자바 객체에 불과하다 <br>
서블릿 컨테이너는 HTTP 요청을 받으면 서블릿 객체의 메소드를 호출하고 그 요청을 매개변수로 제공한다 <br>

또 동일한 메서드는 요청한 클라이언트에 반환할 응답을 설정하기 위해 서블릿에서 사용되는 HTTP 응답을 나타내는 매개변수도 가져온다 <br>

서블릿은 개발자 관점에서 바라볼 때 백엔드 웹 앱에서 가장 중요한 구성 요소였다 <br>

ex) 개발자가 웹 앱의 특정 경로(/home/profile/edit) 에서 엑세스 할 수 있는 새페이지를 구현해야 한다고 가정해보자 <br>
개발자느 새로운 인스턴스를 생성하고, 서블릿 컨테이너에서 구성하며 특정 경로에 할당해야 한다 <br>

서블릿에는 사용자 요청과 관련된 로직과 응답을 준비하는 기능이 포함되어 있다. <br>
웹 클라이언트가 호출할 수 있는 모든 경로에 서블릿 컨테이너에 인스턴스를 추가하고 구성해야한다 <br>

이 컴포넌트가 컨텍스트에 추가한 서블릿 인스턴스를 관리하기 때문에 우리는 서블릿 컨테이너라고 한다 <br>

스프링이 빈을 제어하는것 처럼, 서블릿 인스턴스를 관리하는 컨텍스트가 있다 <br>
톰캣과 같은 그것을 서블릿 컨테이너라고 한다 <br>

서블릿 컨테이너에는 여러 서블릿 인스턴스가 등록되어있다 <br>
각 서블릿은 각각의 경로(Path) 와 연관된다 <br>
1) 클라이언트가 특정 경로에 요청을 보내면 서블릿 컨테이너는 해당 경로에 등록된 서블릿을 호출한다.
2) 서블릿 컨테이너는 http 요청을 변환하고 해당 경로에 연관된 서블릿을 호출할 때 자바 객체로 응답한다.
3) 서블릿 컨테이너는 여러 서블릿 인스턴스를 등록한다. 각 서블릿은 특정 경로에 등록된 자바 객체이다.

<br>
일반적으로 스프링부트 환경에서는 서블릿 인스턴스를 생성하지 않는다 <br>
스프링으로 개발하는 스프링 앱에서 서블릿을 사용하지만 직접 작성할 필요는 없으므로 서블릿 구현 방법을 배우는데 집중하지 않아도 된다 <br>

하지만 서블릿은 앱 로직의 진입점 이라는 점을 기억해야 한다 <br>
서블릿은 서블릿 컨테이너가 상호작용하는 컴포넌트이다 <br>

스프링 어플리케이션은 서블릿 객체를 정의하고, 서블릿 컨테이너에 등록한다 <br>
스프링과 서블릿 컨테이너 모두 이 객체를 알고 관리할 수 있다 <br>
서블릿 컨테이너는 모든 클라이언트 요청에 대해 이 객체를 호출하여 서블릿이 요청과 응답을 관리할 수 있다 <br>

## 스프링 부트의 마법
스프링 웹 앱을 생성하려면 서블릿 컨테이너를 구성하고 서블릿 인스턴스를 생성한 후 클라이언트 요청이 있을 때 톰캣이 서블릿 인스턴스를 호출하도록 구성해야 한다 <br>
지금은 스프링부트를 사용하기 때문에 이러한 귀찮은 설정을 할 필요가 없다 <br>
특히 서비스 지향 아키텍쳐(SOA), 마이크로서비스 아키게처(MSA) 에서는 구성을 작성하는 고충을 덜어주면 큰 도움이 된다<br>

스프링 부트에 좋은 기능
1) 간소화된 프로젝트 생성
2) 의존성 스타터
3) 의존성에 기반을 둔 자동 구성

### 프로젝트 초기화 서비스를 이용한 스프링 부트 프로젝트 생성

### 의존성 스타터를 사용한 의존성 관리 최소화
pom.xml or build.gradle 을 보면 spring-boot-starter-web 이 선언되어 있다 <br>
스프링이 Web 을 사용하면, 스프링 컨테스트, Aop, 톰캣 등이 필요하다는 것을 알고 호환된 특정 버전을 같이 다운 받은 것이다 <br>

### 의존성에 기반을 둔 관례에 따라 autoconfiguration 사용

## 스프링 MVC 로 웹 앱 구현
```java
@Controller
public class MainController {

	@GetMapping("/home")
	public String index() {
		return "index.html";
	}
}

```

1) 클라이언트가 http 요청을 한다
2) 톰캣이 클라이언트 Http 요청을 수신한다. 톰캣은 Http 요청에 대한 서블릿 컴포넌트를 호출해야 한다.
   - 스프링 MVC 의 경우 이 서블릿 이름을 디스패처 서블릿 이라고 한다.
3) 디스패처 서블릿은 스프링 웹 앱의 진입점이다. 톰캣은 수신되는 모든 요청에서 디스패처 서블릿을 호출한다.
   - 디스패처 서블릿은 스프링 앱 내부의 요청을 제어하는 역할을 하므로 요청에 대해 호출할 컨트롤러 액션과 클라이언트 응답으로 전송할 액션을 찾는다
   - 이 서블릿을 '프론트 컨트롤러' 라고도 한다.
4) 디스패처 서블릿이 가장 먼저 할 일은 요청에 대해 호출할 컨트롤러를 찾는다.
   - 이 작업을 **핸들러 매핑이라는 컴포넌트에 위임한다.**
     - 핸들러 매핑이 @GetMapping, @PostMapping, @RequestMapping 을 사용하여 요청과 연관된 컨트롤러를 찾는다.
5) 호출할 컨트롤러 액션을 찾은 후 디스패처 서블릿은 해당되는 특정 컨트롤러 액션을 호출한다.
   - 컨트롤러는 응답을 위해 렌더링 해야하는 페이지 이름을 디스패처 서블릿에 반환한다. 이 HTML 페이지를 뷰라고 한다.
6) 이때 디스패처 서블릿은 컨트롤러에서 받은 이름으로 뷰를 찾아 콘텐츠를 가져오고 그 콘텐츠를 응답으로 보내야 한다.
   - 디스패처 서블릿은 뷰 콘텐츠를 가져오는 책임을 **뷰 리졸버 컴포넌트에 위임한다.**
7) 디스패처 서블릿은 렌더링된 뷰를 HTTP 응답으로 반환한다.

대부분의 주요 로직은 프레임워크에 숨어 있으므로 앱을 더 빠르고 깔끔하게 작성하는데 도움을 준다 <br>



















